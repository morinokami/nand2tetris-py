#!/usr/bin/env python

import os
import sys
sys.path.append(os.path.dirname(os.path.abspath(__file__)) + '/../ch01')

from gates import *

def HalfAdder(a, b):
    """HalfAdder:
       sum = LSB of a + b
       carry = MSB of a + b

    >>> HalfAdder(0, 0)
    [0, 0]
    >>> HalfAdder(0, 1)
    [1, 0]
    >>> HalfAdder(1, 0)
    [1, 0]
    >>> HalfAdder(1, 1)
    [0, 1]

|   a   |   b   |  sum  | carry |
|   0   |   0   |   0   |   0   |
|   0   |   1   |   1   |   0   |
|   1   |   0   |   1   |   0   |
|   1   |   1   |   0   |   1   |
    """

    sum = Xor(a, b)
    carry = And(a, b)
    return [sum, carry]

def FullAdder(a, b, c):
    """FullAdder:
       sum = LSB of a + b + c
       carry = MSB of a + b + c

    >>> FullAdder(0, 0, 0)
    [0, 0]
    >>> FullAdder(0, 0, 1)
    [1, 0]
    >>> FullAdder(0, 1, 0)
    [1, 0]
    >>> FullAdder(0, 1, 1)
    [0, 1]
    >>> FullAdder(1, 0, 0)
    [1, 0]
    >>> FullAdder(1, 0, 1)
    [0, 1]
    >>> FullAdder(1, 1, 0)
    [0, 1]
    >>> FullAdder(1, 1, 1)
    [1, 1]
    """

    s1, c1 = HalfAdder(a, b)
    sum, c2 = HalfAdder(s1, c)
    carry = Or(c1, c2)
    return [sum, carry]

def Add16(a, b):
    """Add16:
       out = a + b

    >>> Add16([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    >>> Add16([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    >>> Add16([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0]
    >>> Add16([1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1])
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    >>> Add16([0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1], [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0])
    [0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1]
    >>> Add16([0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0], [1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0])
    [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0]
    """

    out = []
    s, c = HalfAdder(a[15], b[15])
    out.append(s)
    for i in range(14, -1, -1):
        s, c = FullAdder(c, a[i], b[i])
        out = [s] + out
    return out

def Inc16(_in):
    """Inc16:
       out = _in + 1

    >>> Inc16([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
    >>> Inc16([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    >>> Inc16([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1])
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0]
    >>> Inc16([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1])
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0]
    """

    out = Add16(_in, [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1])
    return out


if __name__ == '__main':
    import doctest
    doctest.testmod()










